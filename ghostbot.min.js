function Ajax(){"use strict";var t={};t.tarUrl="";t.postString="";t.createAjax=function(){var t;if(window.XMLHttpRequest){t=new XMLHttpRequest}else{t=new ActiveXObject("Microsoft.XMLHTTP")}return t};t.xhr=t.createAjax();t.processHandler=function(){if(t.xhr.readyState==4){if(t.xhr.status==200){t.resultHandler(t.xhr.responseText)}}};t.get=function(e,r){t.tarUrl=e;t.resultHandler=r;t.xhr.onreadystatechange=t.processHandler;t.xhr.open("get",t.tarUrl,true);t.xhr.send()};t.post=function(e,r,n){t.tarUrl=e;t.postString=r;t.resultHandler=n;t.xhr.onreadystatechange=t.processHandler;t.xhr.open("post",t.tarUrl,true);t.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");t.xhr.send(t.postString)};return t}var GhostBot=function(t){this.defaults={result_template:"<a href='{{link}}' class='searchResult'>{{title}}</a>",info_template:"<h4>找到{{amount}}篇相关的文章</h4>",rss:"/rss"};var e=this.extend({},this.defaults,t);if(e.inputbox)this.init(e)};GhostBot.prototype.extend=function(){var t=Array.prototype.slice.call(arguments);for(var e=t.length-1;e>0;e--){var r=t[e-1],n=t[e];for(j in n)r[j]=n[j]}return t[0]};GhostBot.prototype.init=function(t){var e=this;this.result_template=t.result_template;this.info_template=t.info_template;this.target=t.target;this.rss=t.rss;this.inputbox=t.inputbox;this.blogData=[];this.ajax=new Ajax;this.loadRss()};GhostBot.prototype.loadRss=function(){if(this.inited)return false;var t=this.index,e=this.rss,r=this.blogData,n=this;this.ajax.get(e,function(t){n.parseXML(t,function(t){var e=t.getElementsByTagName("item");e=Array.prototype.slice.call(e);e=e.map(function(t){if(typeof t=="function")return;return t});n.items=e;n.inited=true;n.listen()})})};GhostBot.prototype.parseXML=function(t,e){var r=null;if(!window.DOMParser&&window.ActiveXObject){var n=["MSXML.2.DOMDocument.6.0","MSXML.2.DOMDocument.3.0","Microsoft.XMLDOM"];for(var a=0;a<n.length;a++){try{r=new ActiveXObject(n[a]);r.async=false;r.loadXML(t);break}catch(o){}}}else if(window.DOMParser&&document.implementation&&document.implementation.createDocument){try{domParser=new DOMParser;r=domParser.parseFromString(t,"text/xml")}catch(o){}}else{return null}e&&e(r);return r};GhostBot.prototype.listen=function(){var t=this;this.inputbox.onkeyup=function(){var e=t.inputbox;if(!e.value)return t.target.innerHTML="";var r=t.search(e.value);var n=t.format(t.info_template,{amount:r.length});var a=n;for(i in r)a+=t.format(t.result_template,r[i]);t.target.innerHTML=a}};GhostBot.prototype.format=function(t,e){return t.replace(/{{([^{}]*)}}/g,function(t,r){var n=e[r];return typeof n==="string"||typeof n==="number"?n:t})};GhostBot.prototype.search=function(t){var e=this;var r=[];var n=new RegExp(t.toLowerCase());this.items.forEach(function(e){var a=e.getElementsByTagName("description")[0].firstChild.data.replace(/<!((\[)?\[)|(\]\]>)/g,"").replace(/<[^>]*>/g,"");var o=e.getElementsByTagName("title")[0].firstChild.data.replace(/<!((\[)?CDATA\[)|(\]\]>)/g,"");if(n.test(o.toLowerCase()+a.toLowerCase())){var s=e.getElementsByTagName("link")[0].firstChild.data;r.push({keyword:t,title:o,link:s,content:a})}});return r};