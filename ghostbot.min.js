var GhostBot=function(a){this.defaults={result_template:"<a href='{{link}}' class='searchResult'>{{title}}</a>",info_template:"<h4>Find{{amount}}Articles.</h4>"};var b=this.extend({},this.defaults,a);if(b.inputbox){this.init(b)}};GhostBot.prototype.extend=function(){var a=Array.prototype.slice.call(arguments);for(var c=a.length-1;c>0;c--){var d=a[c-1],b=a[c];for(j in b){d[j]=b[j]}}return a[0]};GhostBot.prototype.init=function(b){var a=this;this.result_template=b.result_template;this.info_template=b.info_template;this.target=b.target;this.inputbox=b.inputbox;this.blogData=[];this.loadAPI()};GhostBot.prototype.loadAPI=function(){if(this.inited){return false}var c=this.index;var d=this;var e={limit:"all",include:"tags"};var b=120;var a=[];$.get(ghost.url.api("posts",e)).done(function(f){searchData=f.posts;searchData.forEach(function(g){var h=g.tags.map(function(m){return m.name});if(g.meta_description==null){g.meta_description=""}var k=h.join(", ");if(k.length<1){k="undefined"}var l={id:String(g.id),title:String(g.title),slug:String(g.slug),url:String(g.url),markdown:String(g.markdown),pubDate:String(g.created_at.split("T")[0]),tag:k,link:String(g.url),description:String(g.markdown.substr(0,b)),content:g.markdown};a.push(l)});d.items=a;d.inited=true;d.listen()})};GhostBot.prototype.listen=function(){var a=this;this.inputbox.onkeyup=function(){var d=a.inputbox;if(!d.value){return a.target.innerHTML=""}var e=a.search(d.value);var b=a.format(a.info_template,{amount:e.length});var c=b;for(i in e){c+=a.format(a.result_template,e[i])}a.target.innerHTML=c}};GhostBot.prototype.format=function(b,a){return b.replace(/{{([^{}]*)}}/g,function(d,c){var e=a[c];return typeof e==="string"||typeof e==="number"?e:d})};GhostBot.prototype.search=function(d){var c=this;var a=[];var b=new RegExp(d.toLowerCase());this.items.forEach(function(g){var l=g.markdown;var n=g.title;var m=g.pubDate,f=g.url,e=g.slug,k=g.description;if(b.test(n.toLowerCase()+l.toLowerCase()+f.toLowerCase())){var h=g.link;a.push({title:n,link:h,content:l,pubData:g.pubDate,description:g.description})}});return a};
